<!DOCTYPE html>
<html lang="en">
{% extends "layout.html" %}
{% block body %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="static/css/userDashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header>
        <h1>User Dashboard</h1>
        <div class="menu">
            <button class="menu-button">Menu &#9662;</button>
            <div class="menu-content">
                <a href="{{url_for('watchlistView')}}">My WatchList</a>
                <a href="{{ url_for('viewProfile') }}">View Particular</a>
                <a href="{{ url_for('updateProfile') }}">Update Particular</a>
                <a href="{{ url_for('submitFeedback') }}">Submit Feedback</a>
                <form method="POST" action="/deleteProfile" onsubmit="return confirm('Are you sure you wish to delete your account?');">
                    <button type="submit" class="menu-item">Delete Account</button>
                </form>
                <a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you wish to log out?')">Logout</a>
            </div>
        </div>
    </header>

    <form method="POST" action="/userDashboard">
        <section id="search-section">
            <input type="text" id="search-bar" placeholder="Search for stock" name="stockTicker" autocomplete="off">
            <input type="hidden" name="button_identifier" value="search_button">
            <button type="submit" class="icon-button">
                <i class="fa fa-search"></i>
                <span class="tooltip">Search</span>
            </button>
            <br><br>
            {% if error %}
            <strong style="color:red;">Error: {{ error }}</strong>
            {% endif %}
        </section>
    </form>
    {% if timer %}
    <div id="timerLabel" class="timerLabel"><h3 style="color:white;">Trial remaining: </h3></div>
    <div id="timer" class="timer" data-time="{{ timer }}"></div>

    <footer>
        <p>Stock Market Dashboard Â© 2024</p>
    </footer>

    <script>
        function updateTimer(elementId, remainingTime) {
            const timerElement = document.getElementById(elementId);
            let days = parseInt(remainingTime.split(' days ')[0]);
            const parts = remainingTime.split(' days ')[1].split(':');
            let hours = parseInt(parts[0]);
            let minutes = parseInt(parts[1]);
            let seconds = parseInt(parts[2]);

            function tick() {
                if (seconds > 0) {
                    seconds--;
                } else if (minutes > 0) {
                    seconds = 59;
                    minutes--;
                } else if (hours > 0) {
                    seconds = 59;
                    minutes = 59;
                    hours--;
                } else if (days > 0) {
                    seconds = 59;
                    minutes = 59;
                    hours = 23;
                    days--;
                } else {
                    // Keep the time at 0 once the countdown finishes
                    seconds = 0;
                    minutes = 0;
                    hours = 0;
                    days = 0;
                }

                // Format the remaining time in the desired format
                let formattedTime = days + ' days, ' +
                                    hours + ' hrs ' +
                                    minutes + ' mins ' +
                                    seconds + ' secs';

                timerElement.textContent = formattedTime;
            }

            setInterval(tick, 1000);
        }

        document.addEventListener('DOMContentLoaded', function () {
            updateTimer('timer', '{{ timer }}');
        });
    </script>
    {% endif %}

</body>
{% endblock %}
</html>